---
title: "hfm_trial"
output: word_document
date: '2024-05-23'
params:
  para_1: ""

---

```{r setup, include=FALSE}
#source("D:/Users/hudson.fm/Documents/GitHub/ERSautomation/R/tables_source.R")
# change_type <- ifelse(params$para_2 >= params$para_1, "an increase", "a decrease")
# df_month_new <- read_excel(path = "Q:/ASCT/P005 Homelessness/008 Rough Sleeping/RS MI R/New monthly tables script/Git_Version/Publication_tables/Publication_tables240517.xlsx", sheet = "Table_P1(b)_-_RS_month_new", skip = 3)
# df_month <- read_excel(input_path, sheet = "Table_R1(b)_-_RS_month", skip = 3)
#Take this out when running script properly
input_path = "Q:/ASCT/P005 Homelessness/008 Rough Sleeping/RS MI R/New monthly tables script/Git_Version/Publication_tables/Publication_tables240517.xlsx"


df_month_new <- read_excel(input_path, sheet = "Table_P1(b)_-_RS_month_new", skip = 3)
df_month <- read_excel(input_path, sheet = "Table_R1(b)_-_RS_month", skip = 3)
df_snapshot_new <- read_excel(input_path, sheet = "Table_P1(a)_-_RS_snapshot_new", skip = 3)
df_snapshot <- read_excel(input_path, sheet = "Table_R1(a)_-_RS_snapshot", skip = 3)
df_institutions <- read_excel(input_path, sheet = "Table_P2(a)_-_Left_institutions", skip = 3)
df_month_rate <- read_excel(input_path, sheet = "Table_R1(d)_-_RS_month_rate", skip = 3)

knitr::opts_chunk$set(echo = TRUE)

march24_month_eng <- as.numeric(df_month[1, "March 2024"])
march23_month_eng <- as.numeric(df_month[1, "March 2023"])
dec23_month_eng <- as.numeric(df_month[1, "December 2023"])

march24_month_eng_rate <- as.numeric(df_month_rate[1, "March 2024"])
march23_month_eng_rate <- as.numeric(df_month_rate[1, "March 2023"])
dec23_month_eng_rate <- as.numeric(df_month_rate[1, "December 2023"])


march24_month_new_eng <- as.numeric(df_month_new[1, "2024_03_01"])
march23_month_new_eng <- as.numeric(df_month_new[1, "2023_03_01"])

march24_snapshot_new_eng <- as.numeric(df_snapshot_new[1, "March 2024"])
march23_snapshot_new_eng <- as.numeric(df_snapshot_new[1, "March 2023"])

march24_snapshot_eng <- as.numeric(df_snapshot[1, "March 2024"])
march23_snapshot_eng <- as.numeric(df_snapshot[1, "March 2023"])

march24_institutions_eng <- as.numeric(df_institutions[1, "March 2024"])
dec23_institutions_eng <- as.numeric(df_institutions[1, "December 2023"])

```

## Ending Rough Sleeping Data Framework, March 2024

## 1. Key statistics

### Prevented (P1 & P2)

**`r march24_month_new_eng`** new people sleeping rough over the month in March 2024 (`r round(abs((march24_month_new_eng / march24_month_eng)*100),digits = 0)`% of total) - up `r round(abs(((march24_month_new_eng - march23_month_new_eng) / march23_month_new_eng)*100), digits = 0)`% on same period last year.

**`r march24_snapshot_new_eng`** new people sleeping rough on a single night in March 2024 (`r round(abs((march24_snapshot_new_eng / march24_snapshot_eng)*100), digits = 0)`% of the total) - up `r round(abs(((march24_snapshot_new_eng - march23_snapshot_new_eng) / march23_snapshot_new_eng)*100), digits = 0)`% on same period last year. 

**`r march24_institutions_eng`** people sleeping rough over the month in March 2024 who have left an institution (`r round(abs((march24_institutions_eng / march24_month_eng)*100), digits = 0)`% of the total) - down `r round(abs(((march24_institutions_eng - dec23_institutions_eng) / dec23_institutions_eng)*100), digits = 0)`% since same period last quarter. 

### Rare (R1)
**`r march24_month_eng`** people sleeping rough over the month in March 2024 - up (`r round(abs(((march24_month_eng - march23_month_eng)/march23_month_eng)*100), digits = 0)`)% on March last year, and up(`r round(abs(((march24_month_eng - dec23_month_eng)/dec23_month_eng)*100), digits = 0)`)% since December 2023. `r march24_month_eng_rate` people per 100,000 sleeping rough over the month in March 2024 - up from `r march23_month_eng_rate` last year and `r dec23_month_eng_rate` in December 2023.

---

```{r setup, include=FALSE}
#Take this out when running script properly
input_path = "Q:/ASCT/P005 Homelessness/008 Rough Sleeping/RS MI R/New monthly tables script/Git_Version/Publication_tables/Publication_tables240517.xlsx"

new_month_tot <- as.vector(df_month_new[1, c(5:length(df_month_new))])
new_snapshot_tot <- as.vector(df_snapshot_new[1, c(5:length(df_month_new))])

#Match column names then bind into one dataframe
colnames(new_snapshot_tot) <- colnames(new_month_tot) 
new_comb <- bind_rows(new_month_tot, new_snapshot_tot)

#Wrangling to get into desired format
transposed_new <- data.frame(t(new_comb))
transposed_new <-  mutate(transposed_new, "Date" = rownames(transposed_new)) 
rownames(transposed_new) <- NULL
colnames(transposed_new) <- c("New month", "New snapshot", "Date")
new_df <- transposed_new %>%
mutate(Date = as.Date(Date, format = "%Y_%m_%d"), 
       `New month` = as.numeric(`New month`),
       `New snapshot` = as.numeric(`New snapshot`)) %>% 
  select(3, 2, 1)

#Figure 1
figure_1 <- ggplot(new_df, aes(x = Date)) +
  geom_line(aes(y = `New snapshot`, color = "Snapshot_new"), size = 1.1, group = 1) +
  geom_point(aes(y = `New snapshot`), color = "#012169", size = 2) +  # Add points for Snapshot_new
  geom_line(aes(y = `New month`, color = "Month_new"), size = 1.1, group = 1) +
  geom_point(aes(y = `New month`), color = "#95B3D7", size = 2) +
  labs(title = "New people sleeping rough, October 2020 to March 2024", x = "Date", y = "Number of people") +
  scale_color_manual(values = c("Snapshot_new" = "#012169", "Month_new" = "#95B3D7")) +
  dluhc_style(size = 1.5) +
  scale_y_continuous(breaks = seq(0,4000, by = 500),labels = comma)+
  scale_x_date(labels = scales::date_format("%b"), date_breaks = "1 month") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))


```
print(example)

